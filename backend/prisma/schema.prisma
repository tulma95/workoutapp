generator client {
  provider = "prisma-client"
  output   = "../src/generated/prisma"
}

datasource db {
  provider = "postgresql"
}

model Exercise {
  id          Int      @id @default(autoincrement())
  slug        String   @unique
  name        String
  muscleGroup String?  @map("muscle_group")
  category    String   @default("compound")
  isUpperBody Boolean  @default(false) @map("is_upper_body")
  createdAt   DateTime @default(now()) @map("created_at") @db.Timestamptz(3)

  @@map("exercises")
}

model User {
  id             Int      @id @default(autoincrement())
  email          String   @unique
  passwordHash   String   @map("password_hash")
  displayName    String   @map("display_name")
  unitPreference String   @default("kg") @map("unit_preference")
  createdAt      DateTime @default(now()) @map("created_at") @db.Timestamptz(3)
  updatedAt      DateTime @updatedAt @map("updated_at") @db.Timestamptz(3)

  trainingMaxes TrainingMax[]
  workouts      Workout[]

  @@map("users")
}

model TrainingMax {
  id            Int      @id @default(autoincrement())
  userId        Int      @map("user_id")
  exercise      String
  weight        Decimal  @db.Decimal(6, 2)
  effectiveDate DateTime @default(now()) @map("effective_date") @db.Timestamptz(3)
  createdAt     DateTime @default(now()) @map("created_at") @db.Timestamptz(3)

  user User @relation(fields: [userId], references: [id])

  @@unique([userId, exercise, effectiveDate])
  @@map("training_maxes")
}

model Workout {
  id          Int       @id @default(autoincrement())
  userId      Int       @map("user_id")
  dayNumber   Int       @map("day_number")
  status      String    @default("in_progress")
  completedAt DateTime? @map("completed_at") @db.Timestamptz(3)
  createdAt   DateTime  @default(now()) @map("created_at") @db.Timestamptz(3)

  user User         @relation(fields: [userId], references: [id])
  sets WorkoutSet[]

  @@map("workouts")
}

model WorkoutSet {
  id               Int      @id @default(autoincrement())
  workoutId        Int      @map("workout_id")
  exercise         String
  tier             String
  setOrder         Int      @map("set_order")
  prescribedWeight Decimal  @db.Decimal(6, 2) @map("prescribed_weight")
  prescribedReps   Int      @map("prescribed_reps")
  isAmrap          Boolean  @default(false) @map("is_amrap")
  actualReps       Int?     @map("actual_reps")
  completed        Boolean  @default(false)
  createdAt        DateTime @default(now()) @map("created_at") @db.Timestamptz(3)

  workout Workout @relation(fields: [workoutId], references: [id], onDelete: Cascade)

  @@index([workoutId, tier, setOrder])
  @@map("workout_sets")
}
