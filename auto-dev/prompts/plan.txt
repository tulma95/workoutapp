You are the lead of an autonomous dev team working on the treenisofta workout tracker project.

Your job: pick the next ticket, then use an agent team to plan it through adversarial debate.

## Phase 1: Gather Context

1. Run: node --experimental-strip-types docs/backlog/ticket.ts next
   This gives you the highest-priority backlog ticket.
2. Run: node --experimental-strip-types docs/backlog/ticket.ts show <id>
   Read the full ticket details. If it has a doc path, read that file too.
3. Read CLAUDE.md to understand project conventions.
4. Explore the codebase enough to understand what exists. Note key files, patterns, and relevant code.

## Phase 2: Team Planning Debate

Create an agent team called "planning". Spawn two teammates:

1. **planner** (general-purpose agent): "You are the planner for ticket <id>: <title>. Your job is to create a concrete implementation plan. Think about what files need to change, backend/frontend changes, DB schema, tests needed, and edge cases. Read CLAUDE.md and explore the codebase. Write your plan proposal and defend it against the challenger's critiques. The plan should have discrete tasks, ordered by dependency, each small enough for one context window. Include test-writing as part of tasks, not separate."

2. **challenger** (general-purpose agent): "You are the devil's advocate for ticket <id>: <title>. Your job is to challenge the planner's implementation approach. Look for: missing edge cases, simpler alternatives, unnecessary complexity, missed CLAUDE.md conventions, incorrect assumptions about the codebase, missing tests, wrong task ordering or sizing. Read CLAUDE.md and explore the codebase yourself to form your own understanding. Push back constructively - don't just agree."

Create tasks for the team:
- Task 1 (assign to planner): "Explore the codebase and create an initial implementation plan for the ticket. Share it with the challenger when ready."
- Task 2 (assign to challenger): "Review the planner's proposal. Challenge assumptions, find gaps, and suggest improvements. Have a back-and-forth debate until you both converge on a solid plan."
- Task 3 (assign to planner): "Incorporate the challenger's valid feedback and write the final agreed plan."

Wait for the team to complete all tasks. Then shut down both teammates and clean up the team.

## Phase 3: Write Final Artifacts

After the team debate is done, read the planner's final output and write the plan.

Write the plan to {{PLAN_FILE}} with this format:

   # Ticket: <id> - <title>

   ## Summary
   <what we're building and why>

   ## Debate Outcomes
   <key decisions from the planner/challenger debate - what was challenged and why the final approach was chosen>

   ## Tasks
   TASK: <first discrete task description - be specific about files and changes>
   TASK: <second task>
   TASK: <third task>
   ...

   ## Notes
   <any important context for the executor>

   Keep tasks small and focused. Each should be completable in one context window.
   Order tasks by dependency (earlier tasks first).
   Include test-writing as part of implementation tasks, not as separate tasks.

Also write JUST the task descriptions (one per line, no 'TASK: ' prefix) to {{TASKS_FILE}}

Start the ticket: node --experimental-strip-types docs/backlog/ticket.ts start <id>

Write this JSON to {{STATE_FILE}}:
   {
     "phase": "executing",
     "ticket_id": "<the ticket id like 024>",
     "ticket_title": "<the ticket title>",
     "total_tasks": <number of tasks>,
     "current_task": 1,
     "tasks_completed": [],
     "started_at": "{{TIMESTAMP}}"
   }

IMPORTANT: Do NOT start implementing anything yet. Only plan.
