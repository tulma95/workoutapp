You are an autonomous dev agent working on the treenisofta workout tracker project.
You are running non-interactively. AskUserQuestion is unavailable — make all decisions autonomously.

Your job: pick the next ticket and create an implementation plan using two subagents — a planner and a challenger.

## Phase 1: Gather Context

1. Run: node --experimental-strip-types docs/backlog/ticket.ts next
   This gives you the highest-priority backlog ticket.
2. Run: node --experimental-strip-types docs/backlog/ticket.ts show <id>
   Read the full ticket details. If it has a doc path, read that file too.
3. Read CLAUDE.md to understand project conventions.

## Phase 2: Plan via Subagents

Use the Task tool to spawn two subagents sequentially:

**Subagent 1 — Planner** (subagent_type: "general-purpose"):
Prompt it with the ticket details and ask it to:
- Read CLAUDE.md and explore the codebase
- Create a concrete implementation plan with discrete tasks
- Think about: files to change, backend/frontend changes, DB schema, tests, edge cases
- Tasks should be ordered by dependency, each small enough for one context window
- Include test-writing as part of implementation tasks, not separate

**Subagent 2 — Challenger** (subagent_type: "general-purpose"):
Pass the planner's output and prompt it to:
- Read CLAUDE.md and explore the codebase independently
- Challenge the plan: missing edge cases, simpler alternatives, unnecessary complexity, missed conventions, wrong assumptions, missing tests, bad task ordering/sizing
- Return specific critiques and suggested improvements (not just "looks good")

## Phase 3: Synthesize and Write

Read both subagent outputs. Combine the planner's plan with the challenger's valid critiques into a final plan.

Write the plan to {{PLAN_FILE}} with this format:

   # Ticket: <id> - <title>

   ## Summary
   <what we're building and why>

   ## Debate Outcomes
   <what the challenger flagged and how the final plan addresses it>

   ## Tasks
   TASK: <first discrete task description - be specific about files and changes>
   TASK: <second task>
   TASK: <third task>
   ...

   ## Notes
   <any important context for the executor>

   Keep tasks small and focused. Each should be completable in one context window.
   Order tasks by dependency (earlier tasks first).
   Include test-writing as part of implementation tasks, not as separate tasks.

Also write JUST the task descriptions (one per line, no 'TASK: ' prefix) to {{TASKS_FILE}}

Start the ticket: node --experimental-strip-types docs/backlog/ticket.ts start <id>

Write this JSON to {{STATE_FILE}}:
   {
     "phase": "executing",
     "ticket_id": "<the ticket id like 024>",
     "ticket_title": "<the ticket title>",
     "total_tasks": <number of tasks>,
     "current_task": 1,
     "tasks_completed": [],
     "started_at": "{{TIMESTAMP}}"
   }

IMPORTANT: Do NOT start implementing anything yet. Only plan.
